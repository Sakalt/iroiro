<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini4WD in Three.js</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
        }
        button {
            font-size: 16px;
            padding: 10px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <!-- 回転用のボタンを追加 -->
    <div id="controls">
        <button id="rotateUp">上回転</button>
        <button id="rotateDown">下回転</button>
        <button id="rotateLeft">左回転</button>
        <button id="rotateRight">右回転</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // シーン、カメラ、レンダラーの設定
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // ライトの設定
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 5, 5);
        scene.add(light);

        // 車体グループを作成（すべての部品を含むグループ）
        const carGroup = new THREE.Group();
        scene.add(carGroup);

        // シャーシを作成 (ばってん型)
        const chassisGeometry = new THREE.BoxGeometry(6, 0.5, 12); // メインの長方形部分
        const chassisMaterial = new THREE.MeshStandardMaterial({ color: 0x444444 });
        const chassis = new THREE.Mesh(chassisGeometry, chassisMaterial);
        carGroup.add(chassis);

        // X型にバーを追加
        const crossBarGeometry = new THREE.BoxGeometry(12, 0.5, 0.5);
        const crossBar1 = new THREE.Mesh(crossBarGeometry, chassisMaterial);
        const crossBar2 = new THREE.Mesh(crossBarGeometry, chassisMaterial);
        crossBar1.rotation.z = Math.PI / 4;
        crossBar2.rotation.z = -Math.PI / 4;
        chassis.add(crossBar1);
        chassis.add(crossBar2);

        // モーターの追加（中央）
        const motorGeometry = new THREE.CylinderGeometry(1, 1, 3, 32);
        const motorMaterial = new THREE.MeshStandardMaterial({ color: 0x888888 });
        const motor = new THREE.Mesh(motorGeometry, motorMaterial);
        motor.rotation.z = Math.PI / 2;
        motor.position.set(0, 1, 0);
        chassis.add(motor);

        // タイヤの作成 (溝あり)
        function createTire() {
            const tireGeometry = new THREE.TorusGeometry(1.2, 0.5, 16, 100);
            const tireMaterial = new THREE.MeshStandardMaterial({ color: 0x111111 });
            const tire = new THREE.Mesh(tireGeometry, tireMaterial);
            tire.rotation.x = Math.PI / 2; // タイヤを正しい方向に回転
            return tire;
        }

        // カスタムホイールの作成
        function createCustomWheel() {
            const wheelGeometry = new THREE.BufferGeometry();
            const vertices = [];

            const outerRadius = 1.2;
            const innerRadius = 0.4;
            const numSpokes = 5;
            const thickness = 0.3;

            // スポークと外周を作成
            for (let i = 0; i < numSpokes; i++) {
                const angle = (i / numSpokes) * Math.PI * 2;

                // 中央から外周までのスポークを作成
                const x1 = Math.cos(angle) * innerRadius;
                const y1 = Math.sin(angle) * innerRadius;
                const x2 = Math.cos(angle) * outerRadius;
                const y2 = Math.sin(angle) * outerRadius;

                // スポークの両側の頂点
                vertices.push(x1, y1, thickness);
                vertices.push(x2, y2, thickness);
                vertices.push(x1, y1, -thickness);

                vertices.push(x2, y2, thickness);
                vertices.push(x2, y2, -thickness);
                vertices.push(x1, y1, -thickness);
            }

            const positions = new Float32Array(vertices);
            wheelGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const wheelMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFF00, side: THREE.DoubleSide }); // 黄色に設定
            const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            wheel.rotation.x = 180 // ホイールを正しい方向に回転

            return wheel;
        }

        // タイヤとホイールの配置
        const tirePositions = [
            [-3.5, 0, 5],
            [3.5, 0, 5],
            [-3.5, 0, -5],
            [3.5, 0, -5]
        ];

        tirePositions.forEach(pos => {
            const tire = createTire();
            tire.position.set(pos[0], pos[1], pos[2]);
            carGroup.add(tire);

            const wheel = createCustomWheel();
            wheel.position.set(pos[0], pos[1], pos[2]);
            carGroup.add(wheel);
        });

        // カメラ位置
        camera.position.z = 20;

        // 回転速度の変数 (2倍に設定)
        let rotateX = 0;
        let rotateY = 0;

        // ボタンのイベントリスナー
        document.getElementById('rotateUp').addEventListener('click', () => {
            rotateX = -0.1; // 上回転 (2倍速度)
        });

        document.getElementById('rotateDown').addEventListener('click', () => {
            rotateX = 0.1; // 下回転 (2倍速度)
        });

        document.getElementById('rotateLeft').addEventListener('click', () => {
            rotateY = 0.1; // 左回転 (2倍速度)
        });

        document.getElementById('rotateRight').addEventListener('click', () => {
            rotateY = -0.1; // 右回転 (2倍速度)
        });

        // アニメーションループ
        function animate() {
            requestAnimationFrame(animate);

            // 車体全体を回転させる
            carGroup.rotation.x += rotateX;
            carGroup.rotation.y += rotateY;

            // 回転をリセット
            rotateX = 0;
            rotateY = 0;

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
